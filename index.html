<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XIso - Gestion des Preuves ISO 27001</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #00d4ff;
        --primary-dark: #0099cc;
        --primary-light: #80ebff;
        --secondary-color: #0099ff;
        --accent-color: #00ffaa;
        --accent-yellow: #ffcc00;
        --danger-color: #ff3366;
        --warning-color: #ffaa00;
        --success-color: #00ff88;
        --info-color: #00ccff;

        /* Cyber dark gradient */
        --bg-dark-1: #000000;
        --bg-dark-2: #050a0f;
        --bg-dark-3: #0a141f;
        --bg-dark-4: #0f1e2f;

        /* Card backgrounds */
        --card-bg: rgba(10, 20, 31, 0.8);
        --card-bg-light: rgba(15, 30, 47, 0.9);
        --card-bg-hover: rgba(20, 40, 63, 0.95);

        /* Text colors */
        --text-primary: #ffffff;
        --text-secondary: #b3e0ff;
        --text-muted: #66b3ff;
        --text-glow: #00d4ff;

        /* Borders with glow */
        --border-color: rgba(0, 212, 255, 0.2);
        --border-glow: rgba(0, 212, 255, 0.4);

        /* Shadows */
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
        --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.9);
        --shadow-neon: 0 0 20px rgba(0, 212, 255, 0.3);
        --shadow-blue: 0 0 20px rgba(0, 153, 255, 0.3);
        --shadow-green: 0 0 20px rgba(0, 255, 170, 0.3);

        --border-radius: 10px;
        --border-radius-lg: 16px;

        --font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        line-height: 1.6;
        color: var(--text-primary);
        background: linear-gradient(
          135deg,
          var(--bg-dark-1) 0%,
          var(--bg-dark-2) 25%,
          var(--bg-dark-3) 50%,
          var(--bg-dark-4) 100%
        );
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      /* Animated grid background */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            rgba(0, 212, 255, 0.05) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(0, 212, 255, 0.05) 1px, transparent 1px);
        background-size: 50px 50px;
        z-index: -1;
        animation: gridMove 20s linear infinite;
      }

      @keyframes gridMove {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(50px, 50px);
        }
      }

      /* Scan line effect */
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to bottom,
          transparent 95%,
          rgba(0, 212, 255, 0.03) 96%,
          rgba(0, 212, 255, 0.1) 97%,
          rgba(0, 212, 255, 0.03) 98%,
          transparent 99%
        );
        z-index: -1;
        animation: scan 4s linear infinite;
        pointer-events: none;
      }

      @keyframes scan {
        0% {
          transform: translateY(-100%);
        }
        100% {
          transform: translateY(100%);
        }
      }

      /* Header */
      .header {
        background: rgba(5, 10, 15, 0.9);
        backdrop-filter: blur(20px);
        box-shadow: var(--shadow), var(--shadow-neon);
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        border-bottom: 1px solid var(--border-glow);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-image: linear-gradient(
            90deg,
            transparent,
            var(--primary-color),
            transparent
          )
          1;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 1.5rem;
        font-weight: 900;
        color: var(--text-primary);
        text-decoration: none;
        position: relative;
      }

      .logo::after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent,
          var(--primary-color),
          transparent
        );
        opacity: 0.7;
      }

      .logo-icon {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: var(--bg-dark-1);
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 1.5rem;
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        animation: pulse 3s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        50% {
          box-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
        }
      }

      .nav-menu {
        display: flex;
        list-style: none;
        align-items: center;
        gap: 1.5rem;
      }

      .nav-link {
        text-decoration: none;
        color: var(--text-secondary);
        font-weight: 600;
        transition: all 0.3s ease;
        padding: 0.75rem 1.5rem;
        border-radius: var(--border-radius);
        position: relative;
        overflow: hidden;
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid transparent;
      }

      .nav-link::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 212, 255, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .nav-link:hover::before {
        left: 100%;
      }

      .nav-link:hover {
        color: var(--text-primary);
        border-color: var(--primary-color);
        box-shadow: var(--shadow-neon);
      }

      .nav-link.active {
        color: var(--text-primary);
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid var(--primary-color);
        box-shadow: var(--shadow-neon);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1.5rem;
        background: rgba(0, 212, 255, 0.1);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .user-profile:hover {
        border-color: var(--primary-color);
        box-shadow: var(--shadow-neon);
        transform: translateY(-2px);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: var(--bg-dark-1);
        font-size: 1rem;
        box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
      }

      .notification-container {
        position: relative;
      }

      .notification-bell {
        position: relative;
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 1.25rem;
        padding: 0.5rem;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .notification-bell:hover {
        background: rgba(0, 212, 255, 0.2);
        border-color: var(--primary-color);
        color: var(--text-primary);
        box-shadow: var(--shadow-neon);
      }

      .notification-count {
        position: absolute;
        top: 0;
        right: 0;
        background: linear-gradient(135deg, var(--danger-color), #ff0066);
        color: white;
        font-size: 0.7rem;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
      }

      .notifications-panel {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        width: 350px;
        background: var(--card-bg);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-glow);
        box-shadow: var(--shadow-lg), 0 0 20px rgba(0, 212, 255, 0.3);
        z-index: 100;
        backdrop-filter: blur(10px);
      }

      .notifications-panel.active {
        display: block;
      }

      .notification-item {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .notification-item:hover {
        background: rgba(0, 212, 255, 0.05);
      }

      .notification-item.unread {
        background: rgba(0, 212, 255, 0.1);
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .main-container {
        display: flex;
        min-height: 100vh;
        margin-top: 80px;
      }

      .sidebar {
        width: 320px;
        background: var(--card-bg);
        border-right: 1px solid var(--border-glow);
        padding: 2rem;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow), var(--shadow-neon);
        position: relative;
        overflow: hidden;
      }

      .sidebar::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color),
          var(--accent-color)
        );
        animation: slideRight 3s ease-in-out infinite;
      }

      @keyframes slideRight {
        0%,
        100% {
          transform: translateX(-100%);
        }
        50% {
          transform: translateX(100%);
        }
      }

      .main-content {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
      }

      /* Cards */
      .card {
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        border: 1px solid var(--border-color);
        padding: 2rem;
        box-shadow: var(--shadow), var(--shadow-neon);
        margin-bottom: 2rem;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg), var(--shadow-neon);
        border-color: var(--border-glow);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
      }

      .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      }

      .card-subtitle {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
      }

      /* Stats */
      .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--card-bg-light);
        border-radius: var(--border-radius);
        padding: 1.75rem;
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(0, 212, 255, 0.05),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      .stat-card:hover::before {
        transform: translateX(100%);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-neon);
        border-color: var(--primary-color);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 900;
        margin-bottom: 0.5rem;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .stat-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.75rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        width: fit-content;
        border: 1px solid transparent;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .badge-draft {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border-color: rgba(245, 158, 11, 0.3);
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.2);
      }

      .badge-pending {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border-color: rgba(59, 130, 246, 0.3);
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
      }

      .badge-validated {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border-color: rgba(16, 185, 129, 0.3);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
      }

      .badge-rejected {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-color: rgba(239, 68, 68, 0.3);
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
      }

      .status-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* Buttons */
      .btn {
        padding: 0.875rem 1.75rem;
        border-radius: var(--border-radius);
        border: none;
        font-weight: 700;
        font-family: var(--font-family);
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: var(--text-primary);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.6);
      }

      .btn-secondary {
        background: rgba(0, 212, 255, 0.1);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: rgba(0, 212, 255, 0.2);
        border-color: var(--primary-color);
        box-shadow: var(--shadow-neon);
        transform: translateY(-2px);
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success-color), #00cc66);
        color: var(--bg-dark-1);
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--danger-color), #ff0066);
        color: var(--text-primary);
        box-shadow: 0 0 20px rgba(255, 51, 102, 0.4);
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(255, 51, 102, 0.6);
      }

      .btn-sm {
        padding: 0.6rem 1.2rem;
        font-size: 0.85rem;
      }

      .btn-icon {
        width: 40px;
        height: 40px;
        padding: 0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Table */
      .table-container {
        overflow-x: auto;
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-neon);
        position: relative;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1000px;
      }

      thead {
        background: rgba(0, 212, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      th {
        padding: 1.25rem 1.5rem;
        text-align: left;
        font-weight: 700;
        color: var(--text-secondary);
        border-bottom: 2px solid var(--border-glow);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
      }

      th::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--primary-color);
        transition: width 0.3s ease;
      }

      th:hover::after {
        width: 100%;
      }

      td {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      tbody tr {
        background: rgba(10, 20, 31, 0.5);
        transition: all 0.3s ease;
      }

      tbody tr:hover {
        background: rgba(0, 212, 255, 0.05);
        box-shadow: inset 0 0 20px rgba(0, 212, 255, 0.1);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      .actions-cell {
        display: flex;
        gap: 0.75rem;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 2.5rem;
        box-shadow: var(--shadow-lg), 0 0 50px rgba(0, 212, 255, 0.5);
        border: 1px solid var(--border-glow);
        position: relative;
      }

      .modal-content::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(0, 212, 255, 0.05),
          transparent
        );
        pointer-events: none;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-glow);
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      }

      .modal-close {
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        font-size: 1.5rem;
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        background: rgba(255, 51, 102, 0.2);
        border-color: var(--danger-color);
        color: var(--danger-color);
        transform: rotate(90deg);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .form-control {
        width: 100%;
        padding: 1rem;
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        color: var(--text-primary);
        font-family: var(--font-family);
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        background: rgba(0, 212, 255, 0.1);
      }

      .form-select {
        width: 100%;
        padding: 1rem;
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        color: var(--text-primary);
        font-family: var(--font-family);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        background: rgba(0, 212, 255, 0.1);
      }

      .form-file {
        padding: 2rem;
        background: rgba(0, 212, 255, 0.05);
        border: 2px dashed var(--border-color);
        border-radius: var(--border-radius);
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .form-file:hover {
        border-color: var(--primary-color);
        background: rgba(0, 212, 255, 0.1);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
      }

      .form-file input[type="file"] {
        display: none;
      }

      .file-info {
        margin-top: 0.5rem;
        font-size: 0.85rem;
        color: var(--text-muted);
        display: none;
      }

      /* Comments Styles */
      .comments-container {
        margin-top: 1.5rem;
      }

      .comment {
        padding: 1.5rem;
        background: rgba(0, 212, 255, 0.05);
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        border-left: 4px solid var(--primary-color);
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }

      .comment-author {
        font-weight: 600;
        color: var(--text-primary);
      }

      .comment-date {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .comment-content {
        color: var(--text-secondary);
      }

      /* Progress Bar */
      .progress-bar {
        width: 100%;
        height: 8px;
        background-color: var(--bg-dark-3);
        border-radius: 4px;
        margin: 0.75rem 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      .coverage-value {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .quick-actions {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .stats-summary {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .coverage-info {
        padding: 1rem;
        background: rgba(0, 212, 255, 0.05);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
      }

      /* Page Header */
      .page-header {
        margin-bottom: 2rem;
        position: relative;
      }

      .page-header h1 {
        font-size: 2.5rem;
        font-weight: 900;
        margin-bottom: 0.5rem;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color),
          var(--secondary-color)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
      }

      /* Annex Table Special */
      .annex-table {
        max-height: 400px;
        overflow-y: auto;
      }

      .annex-table th {
        position: sticky;
        top: 0;
        background: rgba(0, 212, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      /* Floating Notifications */
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .notification-toast {
        position: fixed;
        top: 100px;
        right: 20px;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .notification-toast .notification {
        background: var(--card-bg);
        color: var(--text-primary);
        padding: 1.25rem 1.75rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg), 0 0 20px rgba(0, 212, 255, 0.3);
        display: flex;
        align-items: center;
        gap: 1rem;
        animation: slideInRight 0.3s ease;
        border-left: 4px solid var(--success-color);
        min-width: 350px;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
      }

      .notification-toast .notification.error {
        border-left-color: var(--danger-color);
        box-shadow: var(--shadow-lg), 0 0 20px rgba(255, 51, 102, 0.3);
      }

      .notification-toast .notification .icon {
        font-size: 1.5rem;
        font-weight: bold;
      }

      .notification-toast .notification.success .icon {
        color: var(--success-color);
      }

      .notification-toast .notification.error .icon {
        color: var(--danger-color);
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .sidebar {
          width: 280px;
        }

        .stats-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 992px) {
        .main-container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          border-right: none;
          border-bottom: 1px solid var(--border-glow);
        }

        .nav-menu {
          flex-wrap: wrap;
          justify-content: center;
        }
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          gap: 1.5rem;
          padding: 1rem;
        }

        .stats-container {
          grid-template-columns: 1fr;
        }

        .main-content {
          padding: 1rem;
        }

        .page-header h1 {
          font-size: 2rem;
        }

        .notification-toast .notification {
          min-width: 280px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">X</div>
        <span>XIso CyberSec</span>
      </div>

      <ul class="nav-menu">
        <li>
          <a href="#" class="nav-link active"
            ><i class="fas fa-shield-alt"></i> RSSI</a
          >
        </li>
      </ul>

      <div class="header-right">
        <div class="notification-container">
          <button class="notification-bell" id="notificationBell">
            <i class="fas fa-bell"></i>
            <span class="notification-count" id="notificationCount">3</span>
          </button>
          <div class="notifications-panel" id="notificationsPanel">
            <div class="notification-item unread">
              <div><strong>Nouvelle preuve créée</strong></div>
              <div class="text-muted">A.5.1 - Politiques de sécurité</div>
              <small>Il y a 5 minutes</small>
            </div>
            <div class="notification-item unread">
              <div><strong>Commentaire ajouté</strong></div>
              <div class="text-muted">Sur la preuve #4</div>
              <small>Il y a 2 heures</small>
            </div>
            <div class="notification-item">
              <div><strong>Preuve envoyée à l'auditeur</strong></div>
              <div class="text-muted">A.8.1 - Dispositifs des utilisateurs</div>
              <small>Hier, 14:30</small>
            </div>
          </div>
        </div>

        <div class="user-profile">
          <div class="user-avatar">RS</div>
          <div>
            <div>RSSI Admin</div>
            <small style="color: var(--text-muted)"
              >Responsable Sécurité SI</small
            >
          </div>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="card">
          <h3 class="card-title">Statut des Preuves</h3>
          <div class="stats-summary">
            <div class="stat-card">
              <div class="stat-value" id="totalEvidences">0</div>
              <div class="stat-label">Total des Preuves</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="draftEvidences">0</div>
              <div class="stat-label">Brouillons</div>
              <div class="stat-badge badge-draft">BROUILLON</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="pendingEvidences">0</div>
              <div class="stat-label">En Attente</div>
              <div class="stat-badge badge-pending">EN_ATTENTE</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Couverture des Contrôles</h3>
          <div class="coverage-info">
            <div class="coverage-value">45%</div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: 45%"></div>
            </div>
            <small class="text-muted">18/40 contrôles Annex A couverts</small>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Actions Rapides</h3>
          <div class="quick-actions">
            <button
              class="btn btn-secondary btn-sm"
              onclick="document.getElementById('newEvidenceForm').scrollIntoView({behavior: 'smooth'})"
            >
              <i class="fas fa-plus"></i> Nouvelle Preuve
            </button>
            <button class="btn btn-secondary btn-sm" onclick="loadEvidences()">
              <i class="fas fa-sync-alt"></i> Actualiser la Liste
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
          <h1>Gestion des Preuves ISO 27001</h1>
          <p class="card-subtitle">
            Système de gestion des preuves de conformité pour les contrôles
            Annex A
          </p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-value" id="totalFiles">0</div>
            <div class="stat-label">Fichiers Déposés</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="last30Days">0</div>
            <div class="stat-label">Derniers 30 Jours</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="coverageScore">45%</div>
            <div class="stat-label">Score de Couverture</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avgResponseTime">2.5j</div>
            <div class="stat-label">Temps Moyen de Traitement</div>
          </div>
        </div>

        <!-- Annex A Reference -->
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="card-title">Référence Annex A ISO 27001</h2>
              <p class="card-subtitle">
                Contrôles principaux pour la gestion des preuves
              </p>
            </div>
          </div>

          <div class="annex-table table-container">
            <table id="annexTable">
              <thead>
                <tr>
                  <th>ID Contrôle</th>
                  <th>Nom du Contrôle</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>A.5.1</strong></td>
                  <td>Politiques de sécurité</td>
                  <td>
                    Établir et maintenir des politiques de sécurité de
                    l'information
                  </td>
                </tr>
                <tr>
                  <td><strong>A.5.2</strong></td>
                  <td>Rôles et responsabilités</td>
                  <td>
                    Attribuer et communiquer les responsabilités de sécurité
                  </td>
                </tr>
                <tr>
                  <td><strong>A.6.1</strong></td>
                  <td>Analyse des risques</td>
                  <td>Identifier et évaluer les risques de sécurité</td>
                </tr>
                <tr>
                  <td><strong>A.6.2</strong></td>
                  <td>Traitement des risques</td>
                  <td>
                    Sélectionner et mettre en œuvre des mesures de traitement
                    des risques
                  </td>
                </tr>
                <tr>
                  <td><strong>A.7.1</strong></td>
                  <td>Screening du personnel</td>
                  <td>
                    Vérifier les antécédents des employés et des sous-traitants
                  </td>
                </tr>
                <tr>
                  <td><strong>A.7.2</strong></td>
                  <td>Formation à la sécurité</td>
                  <td>
                    Fournir une formation et une sensibilisation à la sécurité
                  </td>
                </tr>
                <tr>
                  <td><strong>A.8.1</strong></td>
                  <td>Dispositifs des utilisateurs</td>
                  <td>Gérer la sécurité des terminaux utilisateurs</td>
                </tr>
                <tr>
                  <td><strong>A.8.2</strong></td>
                  <td>Gestion des privilèges</td>
                  <td>Restreindre et contrôler les accès privilégiés</td>
                </tr>
                <tr>
                  <td><strong>A.8.23</strong></td>
                  <td>Filtrage Web</td>
                  <td>Protéger contre les menaces basées sur le web</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- New Evidence Form -->
        <div class="card" id="newEvidenceForm">
          <div class="card-header">
            <div>
              <h2 class="card-title">Déposer une Nouvelle Preuve</h2>
              <p class="card-subtitle">
                Téléchargez un document, une capture ou un rapport lié à un
                contrôle ISO 27001
              </p>
            </div>
          </div>

          <form id="uploadForm" enctype="multipart/form-data">
            <div class="form-group">
              <label class="form-label" for="title">Titre de la Preuve *</label>
              <input
                type="text"
                class="form-control"
                id="title"
                name="title"
                placeholder="Ex: Politique de sécurité informatique v2.0"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="controlId"
                >Contrôle ISO 27001 *</label
              >
              <select
                class="form-select"
                id="controlId"
                name="controlId"
                required
              >
                <option value="">Sélectionner un contrôle...</option>
                <option value="A.5.1">A.5.1 - Politiques de sécurité</option>
                <option value="A.5.2">A.5.2 - Rôles et responsabilités</option>
                <option value="A.6.1">A.6.1 - Analyse des risques</option>
                <option value="A.6.2">A.6.2 - Traitement des risques</option>
                <option value="A.7.1">A.7.1 - Screening du personnel</option>
                <option value="A.7.2">A.7.2 - Formation à la sécurité</option>
                <option value="A.8.1">
                  A.8.1 - Dispositifs des utilisateurs
                </option>
                <option value="A.8.2">A.8.2 - Gestion des privilèges</option>
                <option value="A.8.23">A.8.23 - Filtrage Web</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="description">Description</label>
              <textarea
                class="form-control"
                id="description"
                name="description"
                rows="3"
                placeholder="Décrivez la preuve, son contexte et son lien avec le contrôle..."
              ></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">Fichier de Preuve *</label>
              <div class="form-file" id="fileDropArea">
                <div>
                  <strong>Cliquez pour sélectionner un fichier</strong>
                  <div>ou glissez-déposez ici</div>
                  <small
                    >Formats acceptés: PDF, DOCX, PNG, JPG, XLSX (Max:
                    10MB)</small
                  >
                </div>
                <input
                  type="file"
                  id="file"
                  name="file"
                  required
                  accept=".pdf,.docx,.png,.jpg,.jpeg,.xlsx"
                />
              </div>
              <div class="file-info" id="fileInfo"></div>
            </div>

            <div
              class="form-group"
              style="display: flex; gap: 1rem; margin-top: 2rem"
            >
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-upload"></i> Déposer la Preuve
              </button>
              <button type="reset" class="btn btn-secondary">
                <i class="fas fa-trash"></i> Effacer le Formulaire
              </button>
            </div>
          </form>
        </div>

        <!-- Evidence List -->
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="card-title">Mes Preuves Déposées</h2>
              <p class="card-subtitle">
                Tableau de suivi des preuves de conformité ISO 27001
              </p>
            </div>
            <button class="btn btn-secondary" onclick="loadEvidences()">
              <i class="fas fa-sync-alt"></i> Actualiser
            </button>
          </div>

          <div class="table-container">
            <table id="evidenceTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Titre</th>
                  <th>Contrôle</th>
                  <th>Fichier</th>
                  <th>Statut</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="evidenceTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 3rem">
                    <div>
                      <i class="fas fa-spinner fa-spin"></i> Chargement des
                      preuves...
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <!-- Comments Modal -->
    <div class="modal" id="commentsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">
            <i class="fas fa-comments"></i> Commentaires - Preuve
            <span id="modalEvidenceId"></span>
          </h3>
          <button class="modal-close" onclick="closeModal('commentsModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="comments-container" id="commentsContainer">
          <div class="comment">
            <div class="comment-header">
              <div class="comment-author">RSSI Admin</div>
              <div class="comment-date">10/02/2024 14:30</div>
            </div>
            <div class="comment-content">
              Cette preuve a été préparée suite à l'audit interne du Q1. Elle
              inclut les mises à jour des politiques suite aux changements
              organisationnels.
            </div>
          </div>
        </div>

        <div class="form-group" style="margin-top: 2rem">
          <label class="form-label" for="newComment">
            <i class="fas fa-comment"></i> Ajouter un commentaire interne
          </label>
          <textarea
            class="form-control"
            id="newComment"
            rows="3"
            placeholder="Votre commentaire..."
          ></textarea>
          <button class="btn btn-primary" style="margin-top: 1rem">
            <i class="fas fa-comment-medical"></i> Ajouter Commentaire
          </button>
        </div>
      </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal" id="notificationModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title"><i class="fas fa-bell"></i> Notifications</h3>
          <button class="modal-close" onclick="closeModal('notificationModal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="notificationList">
          <!-- Notifications seront chargées ici -->
        </div>
      </div>
    </div>

    <script>
      // Variables globales
      let evidences = [];
      let notifications = [
        {
          id: 1,
          type: "new_evidence",
          title: "Nouvelle preuve créée",
          description: "A.5.1 - Politiques de sécurité",
          time: "Il y a 5 minutes",
          read: false,
        },
        {
          id: 2,
          type: "comment",
          title: "Commentaire ajouté",
          description: "Sur la preuve #4",
          time: "Il y a 2 heures",
          read: false,
        },
        {
          id: 3,
          type: "sent_to_auditor",
          title: "Preuve envoyée à l'auditeur",
          description: "A.8.1 - Dispositifs des utilisateurs",
          time: "Hier, 14:30",
          read: true,
        },
      ];

      // État de l'application
      const state = {
        currentEvidenceId: null,
        isLoading: false,
      };

      // Initialisation
      document.addEventListener("DOMContentLoaded", function () {
        loadEvidences();
        setupEventListeners();
        updateNotificationCount();

        // Simuler des données initiales
        setTimeout(() => {
          updateStats();
        }, 1000);
      });

      // Configuration des écouteurs d'événements
      function setupEventListeners() {
        // Gestion du téléversement de fichier
        const fileInput = document.getElementById("file");
        const fileDropArea = document.getElementById("fileDropArea");
        const fileInfo = document.getElementById("fileInfo");

        fileDropArea.addEventListener("click", () => fileInput.click());

        fileInput.addEventListener("change", function () {
          if (this.files.length > 0) {
            const file = this.files[0];
            fileInfo.innerHTML = `
                        <strong>${file.name}</strong> (${formatFileSize(
              file.size
            )})
                        <br><small>Type: ${file.type || "Non spécifié"}</small>
                    `;
            fileInfo.style.display = "block";
          }
        });

        // Gestion du drag and drop
        fileDropArea.addEventListener("dragover", (e) => {
          e.preventDefault();
          fileDropArea.style.borderColor = "var(--primary-color)";
          fileDropArea.style.backgroundColor = "rgba(0, 212, 255, 0.1)";
        });

        fileDropArea.addEventListener("dragleave", () => {
          fileDropArea.style.borderColor = "var(--border-color)";
          fileDropArea.style.backgroundColor = "rgba(0, 212, 255, 0.05)";
        });

        fileDropArea.addEventListener("drop", (e) => {
          e.preventDefault();
          fileDropArea.style.borderColor = "var(--border-color)";
          fileDropArea.style.backgroundColor = "rgba(0, 212, 255, 0.05)";

          if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            const file = e.dataTransfer.files[0];
            fileInfo.innerHTML = `
                        <strong>${file.name}</strong> (${formatFileSize(
              file.size
            )})
                        <br><small>Type: ${file.type || "Non spécifié"}</small>
                    `;
            fileInfo.style.display = "block";
          }
        });

        // Soumission du formulaire
        document
          .getElementById("uploadForm")
          .addEventListener("submit", handleSubmitEvidence);

        // Notifications
        document
          .getElementById("notificationBell")
          .addEventListener("click", toggleNotificationsPanel);

        // Fermer le panneau de notifications en cliquant ailleurs
        document.addEventListener("click", (e) => {
          const panel = document.getElementById("notificationsPanel");
          const bell = document.getElementById("notificationBell");

          if (!panel.contains(e.target) && !bell.contains(e.target)) {
            panel.classList.remove("active");
          }
        });
      }

      // Charger les preuves depuis l'API
      async function loadEvidences() {
        state.isLoading = true;
        const tableBody = document.getElementById("evidenceTableBody");
        tableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 3rem;">
                        <div><i class="fas fa-spinner fa-spin"></i> Chargement des preuves...</div>
                    </td>
                </tr>
            `;

        try {
          const response = await fetch("/evidence/list");
          if (response.ok) {
            evidences = await response.json();
            renderEvidencesTable();
            updateStats();
          } else {
            showError("Erreur lors du chargement des preuves");
            // Afficher des données de démonstration si l'API n'est pas disponible
            setTimeout(() => {
              loadDemoEvidences();
            }, 500);
          }
        } catch (error) {
          console.error("Erreur:", error);
          showError("Impossible de se connecter au serveur");
          // Afficher des données de démonstration
          setTimeout(() => {
            loadDemoEvidences();
          }, 500);
        }

        state.isLoading = false;
      }

      // Charger des preuves de démonstration
      function loadDemoEvidences() {
        evidences = [
          {
            id: 1,
            title: "Politique de sécurité informatique",
            description: "Document officiel des politiques de sécurité",
            controlId: "A.5.1",
            fileId: "file1.pdf",
            status: "EN_ATTENTE",
            createdAt: "2024-02-10T14:30:00",
          },
          {
            id: 2,
            title: "Matrice des responsabilités",
            description: "Tableau des rôles et responsabilités sécurité",
            controlId: "A.5.2",
            fileId: "file2.xlsx",
            status: "BROUILLON",
            createdAt: "2024-02-09T10:15:00",
          },
          {
            id: 3,
            title: "Rapport d'analyse des risques",
            description: "Évaluation des risques Q4 2023",
            controlId: "A.6.1",
            fileId: "file3.pdf",
            status: "EN_ATTENTE",
            createdAt: "2024-02-08T16:45:00",
          },
          {
            id: 4,
            title: "Procédure de filtrage web",
            description: "Configuration et règles de filtrage",
            controlId: "A.8.23",
            fileId: "file4.docx",
            status: "BROUILLON",
            createdAt: "2024-02-07T09:20:00",
          },
        ];

        renderEvidencesTable();
        updateStats();
      }

      // Afficher les preuves dans le tableau
      function renderEvidencesTable() {
        const tableBody = document.getElementById("evidenceTableBody");

        if (evidences.length === 0) {
          tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 3rem;">
                            <div><i class="fas fa-inbox"></i> Aucune preuve n'a été déposée.</div>
                            <button class="btn btn-primary" style="margin-top: 1rem;" onclick="document.getElementById('newEvidenceForm').scrollIntoView({behavior: 'smooth'})">
                                Déposer votre première preuve
                            </button>
                        </td>
                    </tr>
                `;
          return;
        }

        let html = "";

        evidences.forEach((evidence) => {
          const date = new Date(evidence.createdAt);
          const formattedDate = date.toLocaleDateString("fr-FR");
          const formattedTime = date.toLocaleTimeString("fr-FR", {
            hour: "2-digit",
            minute: "2-digit",
          });

          let statusBadge;
          if (evidence.status === "BROUILLON") {
            statusBadge =
              '<span class="status-badge badge-draft"><i class="fas fa-edit"></i> BROUILLON</span>';
          } else if (evidence.status === "EN_ATTENTE") {
            statusBadge =
              '<span class="status-badge badge-pending"><i class="fas fa-clock"></i> EN_ATTENTE</span>';
          } else if (evidence.status === "VALIDEE") {
            statusBadge =
              '<span class="status-badge badge-validated"><i class="fas fa-check-circle"></i> VALIDÉE</span>';
          } else if (evidence.status === "REFUSEE") {
            statusBadge =
              '<span class="status-badge badge-rejected"><i class="fas fa-times-circle"></i> REFUSÉE</span>';
          }

          const fileExtension = evidence.fileId
            ? evidence.fileId.split(".").pop().toUpperCase()
            : "PDF";

          html += `
                    <tr>
                        <td><strong>#${evidence.id}</strong></td>
                        <td>
                            <strong>${evidence.title}</strong>
                            <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">
                                <i class="fas fa-file-alt"></i> ${evidence.description.substring(
                                  0,
                                  50
                                )}${
            evidence.description.length > 50 ? "..." : ""
          }
                            </div>
                        </td>
                        <td><span style="background: rgba(0, 212, 255, 0.1); padding: 0.3rem 0.6rem; border-radius: 4px; font-weight: 700;">${
                          evidence.controlId
                        }</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="downloadEvidence(${
                              evidence.id
                            })">
                                <i class="fas fa-file"></i> ${fileExtension}
                            </button>
                        </td>
                        <td>${statusBadge}</td>
                        <td>${formattedDate}<br><small style="color: var(--text-muted);">${formattedTime}</small></td>
                        <td class="actions-cell">
                            <button class="btn btn-icon btn-secondary" title="Télécharger" onclick="downloadEvidence(${
                              evidence.id
                            })">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-icon btn-secondary" title="Commentaires" onclick="openComments(${
                              evidence.id
                            })">
                                <i class="fas fa-comments"></i>
                            </button>
                            ${
                              evidence.status === "BROUILLON"
                                ? `<button class="btn btn-icon btn-success" title="Envoyer à l'auditeur" onclick="sendToAuditor(${evidence.id})">
                                    <i class="fas fa-paper-plane"></i>
                                </button>`
                                : ""
                            }
                            <button class="btn btn-icon btn-danger" title="Supprimer" onclick="deleteEvidence(${
                              evidence.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
        });

        tableBody.innerHTML = html;
      }

      // Soumettre une nouvelle preuve
      async function handleSubmitEvidence(e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        // Validation
        const title = formData.get("title");
        const controlId = formData.get("controlId");
        const file = formData.get("file");

        if (!title || !controlId || !file) {
          showError("Veuillez remplir tous les champs obligatoires");
          return;
        }

        if (file.size > 10 * 1024 * 1024) {
          // 10MB limit
          showError("Le fichier est trop volumineux (max: 10MB)");
          return;
        }

        try {
          const response = await fetch("/evidence/create", {
            method: "POST",
            body: formData,
          });

          if (response.ok) {
            const result = await response.json();
            showSuccess("Preuve déposée avec succès !");
            form.reset();
            document.getElementById("fileInfo").style.display = "none";

            // Ajouter une notification
            addNotification(
              "new_evidence",
              "Nouvelle preuve créée",
              `${controlId} - ${title}`,
              "À l'instant"
            );

            // Recharger la liste
            loadEvidences();
          } else {
            const errorText = await response.text();
            showError(`Erreur: ${errorText}`);
          }
        } catch (error) {
          console.error("Erreur:", error);
          showError("Erreur lors du dépôt de la preuve");

          // Simulation de succès pour la démonstration
          setTimeout(() => {
            showSuccess("Preuve déposée avec succès ! (Démo)");
            form.reset();
            document.getElementById("fileInfo").style.display = "none";
            addNotification(
              "new_evidence",
              "Nouvelle preuve créée",
              `${controlId} - ${title}`,
              "À l'instant"
            );
            loadEvidences();
          }, 500);
        }
      }

      // Télécharger une preuve
      async function downloadEvidence(id) {
        try {
          const response = await fetch(`/evidence/${id}/download`);

          if (response.ok) {
            const contentDisposition = response.headers.get(
              "Content-Disposition"
            );
            let filename = `evidence_${id}`;

            if (contentDisposition) {
              const filenameMatch = contentDisposition.match(
                /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/
              );
              if (filenameMatch && filenameMatch[1]) {
                filename = filenameMatch[1].replace(/['"]/g, "");
              }
            } else {
              const evidence = evidences.find((e) => e.id === id);
              if (evidence && evidence.fileId) {
                const ext = evidence.fileId.split(".").pop();
                filename = `${evidence.title.replace(
                  /[^a-z0-9]/gi,
                  "_"
                )}.${ext}`;
              } else {
                const contentType = response.headers.get("Content-Type");
                const ext = getExtensionFromContentType(contentType) || "bin";
                filename = `evidence_${id}.${ext}`;
              }
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.style.display = "none";
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            showSuccess("Fichier téléchargé avec succès");
            addNotification(
              "download",
              "Preuve téléchargée",
              `Preuve #${id}`,
              "À l'instant"
            );
          } else {
            showError("Erreur lors du téléchargement");
          }
        } catch (error) {
          console.error("Erreur:", error);
          showError("Erreur de connexion au serveur");
        }
      }

      // Envoyer à l'auditeur
      async function sendToAuditor(id) {
        if (!confirm("Envoyer cette preuve à l'auditeur pour validation ?")) {
          return;
        }

        try {
          const response = await fetch(`/evidence/${id}/send`, {
            method: "PUT",
          });

          if (response.ok) {
            showSuccess("Preuve envoyée à l'auditeur");

            const evidenceIndex = evidences.findIndex((e) => e.id === id);
            if (evidenceIndex !== -1) {
              evidences[evidenceIndex].status = "EN_ATTENTE";
              renderEvidencesTable();
              updateStats();
            }

            addNotification(
              "sent_to_auditor",
              "Preuve envoyée à l'auditeur",
              `Preuve #${id}`,
              "À l'instant"
            );
          } else {
            showError("Erreur lors de l'envoi à l'auditeur");
          }
        } catch (error) {
          console.error("Erreur:", error);
          showError("Erreur de connexion au serveur");

          setTimeout(() => {
            showSuccess("Preuve envoyée à l'auditeur (Démo)");
            const evidenceIndex = evidences.findIndex((e) => e.id === id);
            if (evidenceIndex !== -1) {
              evidences[evidenceIndex].status = "EN_ATTENTE";
              renderEvidencesTable();
              updateStats();
            }
            addNotification(
              "sent_to_auditor",
              "Preuve envoyée à l'auditeur",
              `Preuve #${id}`,
              "À l'instant"
            );
          }, 500);
        }
      }

      // Supprimer une preuve
      async function deleteEvidence(id) {
        if (
          !confirm(
            "Êtes-vous sûr de vouloir supprimer cette preuve ? Cette action est irréversible."
          )
        ) {
          return;
        }

        try {
          const response = await fetch(`/evidence/${id}`, {
            method: "DELETE",
          });

          if (response.ok) {
            showSuccess("Preuve supprimée avec succès");
            evidences = evidences.filter((e) => e.id !== id);
            renderEvidencesTable();
            updateStats();
            addNotification(
              "delete",
              "Preuve supprimée",
              `Preuve #${id}`,
              "À l'instant"
            );
          } else {
            showError("Erreur lors de la suppression");
          }
        } catch (error) {
          console.error("Erreur:", error);
          showError("Erreur de connexion au serveur");

          setTimeout(() => {
            showSuccess("Preuve supprimée avec succès (Démo)");
            evidences = evidences.filter((e) => e.id !== id);
            renderEvidencesTable();
            updateStats();
            addNotification(
              "delete",
              "Preuve supprimée",
              `Preuve #${id}`,
              "À l'instant"
            );
          }, 500);
        }
      }

      // Ouvrir les commentaires
      function openComments(id) {
        state.currentEvidenceId = id;
        document.getElementById("modalEvidenceId").textContent = id;

        const evidence = evidences.find((e) => e.id === id);
        const commentsContainer = document.getElementById("commentsContainer");

        let commentsHtml = `
                <div class="comment">
                    <div class="comment-header">
                        <div class="comment-author">RSSI Admin</div>
                        <div class="comment-date">${new Date().toLocaleDateString(
                          "fr-FR"
                        )} ${new Date().toLocaleTimeString("fr-FR", {
          hour: "2-digit",
          minute: "2-digit",
        })}</div>
                    </div>
                    <div class="comment-content">
                        Preuve pour le contrôle <strong>${
                          evidence.controlId
                        }</strong>: ${evidence.title}
                    </div>
                </div>
            `;

        if (evidence.description) {
          commentsHtml += `
                    <div class="comment">
                        <div class="comment-header">
                            <div class="comment-author">RSSI Admin</div>
                            <div class="comment-date">${new Date(
                              evidence.createdAt
                            ).toLocaleDateString("fr-FR")} ${new Date(
            evidence.createdAt
          ).toLocaleTimeString("fr-FR", {
            hour: "2-digit",
            minute: "2-digit",
          })}</div>
                        </div>
                        <div class="comment-content">
                            ${evidence.description}
                        </div>
                    </div>
                `;
        }

        commentsContainer.innerHTML = commentsHtml;
        openModal("commentsModal");
      }

      // Mettre à jour les statistiques
      function updateStats() {
        const total = evidences.length;
        const draft = evidences.filter((e) => e.status === "BROUILLON").length;
        const pending = evidences.filter(
          (e) => e.status === "EN_ATTENTE"
        ).length;

        document.getElementById("totalEvidences").textContent = total;
        document.getElementById("draftEvidences").textContent = draft;
        document.getElementById("pendingEvidences").textContent = pending;
        document.getElementById("totalFiles").textContent = total;
        document.getElementById("last30Days").textContent = Math.floor(
          total * 0.7
        );

        const uniqueControls = [...new Set(evidences.map((e) => e.controlId))];
        const coverage = Math.min(
          Math.round((uniqueControls.length / 9) * 100),
          100
        );
        document.getElementById("coverageScore").textContent = `${coverage}%`;
      }

      // Gestion des notifications
      function toggleNotificationsPanel() {
        const panel = document.getElementById("notificationsPanel");
        panel.classList.toggle("active");
        notifications.forEach((n) => (n.read = true));
        updateNotificationCount();
      }

      function updateNotificationCount() {
        const unreadCount = notifications.filter((n) => !n.read).length;
        document.getElementById("notificationCount").textContent = unreadCount;
        document.getElementById("notificationCount").style.display =
          unreadCount > 0 ? "flex" : "none";
      }

      function addNotification(type, title, description, time) {
        const id = notifications.length + 1;
        notifications.unshift({
          id,
          type,
          title,
          description,
          time,
          read: false,
        });
        updateNotificationCount();
      }

      // Gestion des modales
      function openModal(modalId) {
        document.getElementById(modalId).classList.add("active");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
      }

      // Fonctions utilitaires
      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function getExtensionFromContentType(contentType) {
        const mimeTypes = {
          "application/pdf": "pdf",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
            "docx",
          "application/msword": "doc",
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":
            "xlsx",
          "application/vnd.ms-excel": "xls",
          "image/png": "png",
          "image/jpeg": "jpg",
          "image/jpg": "jpg",
        };
        return mimeTypes[contentType] || null;
      }

      // Notification system
      function getOrCreateNotificationContainer() {
        let container = document.querySelector(".notification-toast");
        if (!container) {
          container = document.createElement("div");
          container.className = "notification-toast";
          document.body.appendChild(container);
        }
        return container;
      }

      function showSuccess(message) {
        showNotification(message, "success");
      }

      function showError(message) {
        showNotification(message, "error");
      }

      function showNotification(message, type = "success") {
        const container = getOrCreateNotificationContainer();
        const notification = document.createElement("div");
        notification.className =
          type === "error" ? "notification error" : "notification";
        notification.innerHTML = `
                <div class="icon">${type === "error" ? "⚠" : "✓"}</div>
                <div>${message}</div>
            `;
        container.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = "slideOutRight 0.3s ease";
          setTimeout(() => notification.remove(), 300);
        }, 4000);
      }

      // Export des preuves (simulation)
      function exportEvidences() {
        showSuccess("Rapport généré avec succès (simulation)");
        addNotification(
          "export",
          "Rapport exporté",
          "Toutes les preuves",
          "À l'instant"
        );
      }
    </script>
  </body>
</html>
